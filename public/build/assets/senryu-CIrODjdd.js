document.addEventListener("DOMContentLoaded",function(){let a=document.getElementById("drop-area"),s=document.getElementById("fileElem"),y=document.getElementById("file-name"),i=document.getElementById("preview-container"),r=document.getElementById("reselect-btn"),c=document.getElementById("toukou-btn"),f=!1;["dragenter","dragover","dragleave","drop"].forEach(e=>{a.addEventListener(e,h,!1),document.body.addEventListener(e,h,!1)}),a.addEventListener("drop",w,!1),s.addEventListener("change",g,!1),r.addEventListener("click",function(){C(),s.value="",f=!1,a.style.display="block",r.style.display="none",c.style.display="none"});function h(e){e.preventDefault(),e.stopPropagation()}function w(e){let n=e.dataTransfer.files;g({target:{files:n}})}function g(e){let t=e.target.files;if(t.length>0){const n=t[0];y.innerText=n.name,L(n),f=!0}}function L(e){for(;i.firstChild;)i.removeChild(i.firstChild);if(e.type.startsWith("image/")){let t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){let n=document.createElement("img");n.src=t.result,n.classList.add("preview"),i.appendChild(n),n.onload=function(){const o=document.createElement("canvas"),b=o.getContext("2d"),m=800,u=600;let l=n.width,d=n.height;l>d?l>m&&(d*=m/l,l=m):d>u&&(l*=u/d,d=u),o.width=l,o.height=d,b.drawImage(n,0,0,l,d),o.toBlob(function(v){const B=new File([v],e.name,{type:e.type,lastModified:Date.now()}),E=new DataTransfer;E.items.add(B),s.files=E.files;const p=document.createElement("img");p.src=URL.createObjectURL(v),p.classList.add("preview"),i.innerHTML="",i.appendChild(p),a.style.display="none",r.style.display="block",c.style.display="block"},"image/jpeg",.75)}}}else if(e.type.startsWith("video/")){const t=document.createElement("video");t.src=URL.createObjectURL(e),t.controls=!0,t.classList.add("preview"),i.appendChild(t),a.style.display="none",r.style.display="block",c.style.display="block"}}function C(){for(;i.firstChild;)i.removeChild(i.firstChild);y.innerText=""}document.querySelector("form").addEventListener("submit",function(e){if(document.querySelector("form").getAttribute("data-type")==="edit"&&!f)return;s.files.length===0&&(e.preventDefault(),alert("ファイルが選択されていません。"))})});
